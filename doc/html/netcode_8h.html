<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>honeybrid: netcode.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>netcode.h File Reference</h1><code>#include &lt;netinet/tcp.h&gt;</code><br>
<code>#include &lt;netinet/udp.h&gt;</code><br>
<code>#include &lt;netinet/ip.h&gt;</code><br>
<code>#include &quot;<a class="el" href="tables_8h-source.html">tables.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="types_8h-source.html">types.h</a>&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for netcode.h:</div>
<div class="dynsection">
<p><center><img src="netcode_8h__incl.png" border="0" usemap="#netcode.h_map" alt=""></center>
<map name="netcode.h_map">
<area shape="rect" href="tables_8h.html" title="tables.h" alt="" coords="589,84,661,111"><area shape="rect" href="types_8h.html" title="types.h" alt="" coords="375,161,441,188"><area shape="rect" href="modules_8h.html" title="modules.h" alt="" coords="581,239,669,265"><area shape="rect" href="log_8h.html" title="log.h" alt="" coords="619,316,669,343"></map>
</div>

<p>
<div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dynsection">
<p><center><img src="netcode_8h__dep__incl.png" border="0" usemap="#netcode.hdep_map" alt=""></center>
<map name="netcode.hdep_map">
<area shape="rect" href="decision__engine_8c.html" title="Decision Engine for honeybrid." alt="" coords="5,84,139,111"><area shape="rect" href="honeybrid_8c.html" title="Main File." alt="" coords="163,84,259,111"><area shape="rect" href="mod__control_8c.html" title="Source IP based control engine to rate limit high interaction honeypot." alt="" coords="283,84,395,111"><area shape="rect" href="mod__hash_8c.html" title="SHA 1 Module for honeybrid Decision Engine." alt="" coords="419,84,517,111"><area shape="rect" href="mod__random_8c.html" title="RANDOM module for honeybrid Decision Engine." alt="" coords="541,84,659,111"><area shape="rect" href="mod__source_8c.html" title="Source IP based filtering Module for honeybrid Decision Engine." alt="" coords="683,84,795,111"><area shape="rect" href="netcode_8c.html" title="Network functions file." alt="" coords="819,84,901,111"><area shape="rect" href="tables_8c.html" title="Information tables file." alt="" coords="925,84,997,111"></map>
</div>

<p>
<a href="netcode_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpseudotcphdr.html">pseudotcphdr</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtcp__chk__packet.html">tcp_chk_packet</a></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="netcode_8h.html#eca034f67218340ecb2261a22c2f3dcd">BUFSIZE</a>&nbsp;&nbsp;&nbsp;2048</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="netcode_8h.html#5b7827c561225b58a81718e27501307f">send_raw</a> (struct iphdr *p)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">send a <a class="el" href="structpacket.html">packet</a> over a raw socket  <a href="#5b7827c561225b58a81718e27501307f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="netcode_8h.html#f6f22be6ccd514e154f5e811188d051b">forward</a> (struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *pkt)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">forward the <a class="el" href="structpacket.html">packet</a> to the attacker or to the HIH according to its origin  <a href="#f6f22be6ccd514e154f5e811188d051b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="netcode_8h.html#0a17e9db29ce866d9dbb3f8e000d4d88">reply_reset</a> (struct <a class="el" href="structpacket.html">packet</a> p)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">creat a RST <a class="el" href="structpacket.html">packet</a> from a unexepcted <a class="el" href="structpacket.html">packet</a> and sends it with send_raw  <a href="#0a17e9db29ce866d9dbb3f8e000d4d88"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="netcode_8h.html#f069fcb9bc933b9dab86937fe65ca0f5">reset_lih</a> (struct <a class="el" href="structconn__struct.html">conn_struct</a> *connection_data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">reset the LIH when redirected to HIH  <a href="#f069fcb9bc933b9dab86937fe65ca0f5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="netcode_8h.html#8035030afa1e2ef8c04d0967d8a1ca51">replay</a> (struct <a class="el" href="structconn__struct.html">conn_struct</a> *connection_data, struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *pkt)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">reset the LIH when redirected to HIH  <a href="#8035030afa1e2ef8c04d0967d8a1ca51"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="netcode_8h.html#d578a8a62778555fafc3e1c85b67cc87">hb_ip_checksum</a> (struct iphdr *hdr)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">update the checksum in the IP header  <a href="#d578a8a62778555fafc3e1c85b67cc87"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="netcode_8h.html#76a1641651a94e4de2c397985c74ccd3">tcp_checksum</a> (struct <a class="el" href="structtcp__packet.html">tcp_packet</a> *pkt)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="netcode_8h.html#097d65899a9a179c22b9a47c188a6618">udp_checksum</a> (struct <a class="el" href="structudp__packet.html">udp_packet</a> *hdr)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">update the checksum in the UDP header  <a href="#097d65899a9a179c22b9a47c188a6618"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="netcode_8h.html#1c5840a3c34e17e78c5dff573966d75d">define_expected_data</a> (struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *pkt)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">define expected <a class="el" href="structpacket.html">packet</a> from HIH according to the <a class="el" href="structpacket.html">packet</a> from LIH  <a href="#1c5840a3c34e17e78c5dff573966d75d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="netcode_8h.html#51d4e253ea023290921f37ed78526d67">test_expected</a> (struct <a class="el" href="structconn__struct.html">conn_struct</a> *connection_data, struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *pkt)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">get the <a class="el" href="structpacket.html">packet</a> from HIH, compare it to expected data, drop it and return the comparison result  <a href="#51d4e253ea023290921f37ed78526d67"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="netcode_8h.html#66fca3b08b64c478b6d91e83f2326628">init_raw_sockets</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">create the two raw sockets for UDP/IP and TCP/IP  <a href="#66fca3b08b64c478b6d91e83f2326628"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="netcode_8h.html#a2f45e08bb2bae9d3c173db57d51de47">udp_rsd</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="netcode_8h.html#cc494fc39cad003e3dab07fd09ffc2b2">tcp_rsd</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="eca034f67218340ecb2261a22c2f3dcd"></a><!-- doxytag: member="netcode.h::BUFSIZE" ref="eca034f67218340ecb2261a22c2f3dcd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BUFSIZE&nbsp;&nbsp;&nbsp;2048          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
number of bytes in the payload we want to copy to userspace a regular ethernet connection limit payload size to 1500 bytes 
</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="1c5840a3c34e17e78c5dff573966d75d"></a><!-- doxytag: member="netcode.h::define_expected_data" ref="1c5840a3c34e17e78c5dff573966d75d" args="(struct pkt_struct *pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int define_expected_data           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>pkt</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
define expected <a class="el" href="structpacket.html">packet</a> from HIH according to the <a class="el" href="structpacket.html">packet</a> from LIH 
<p>
define_expected_data<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pkt,:</em>&nbsp;</td><td><a class="el" href="structpacket.html">packet</a> metadata used </td></tr>
  </table>
</dl>

<p>References <a class="el" href="types_8h-source.html#l00212">pkt_struct::conn</a>, <a class="el" href="types_8h-source.html#l00126">hih_struct::delta</a>, <a class="el" href="types_8h-source.html#l00178">conn_struct::expected_data</a>, <a class="el" href="types_8h-source.html#l00180">conn_struct::hih</a>, <a class="el" href="types_8h-source.html#l00074">packet::ip</a>, <a class="el" href="types_8h-source.html#l00140">expected_data_struct::ip_proto</a>, <a class="el" href="types_8h-source.html#l00179">conn_struct::lock</a>, <a class="el" href="tables_8h-source.html#l00140">OK</a>, <a class="el" href="types_8h-source.html#l00207">pkt_struct::packet</a>, <a class="el" href="types_8h-source.html#l00077">packet::payload</a>, <a class="el" href="types_8h-source.html#l00143">expected_data_struct::payload</a>, <a class="el" href="types_8h-source.html#l00075">packet::tcp</a>, <a class="el" href="types_8h-source.html#l00142">expected_data_struct::tcp_ack_seq</a>, and <a class="el" href="types_8h-source.html#l00141">expected_data_struct::tcp_seq</a>.</p>

<p>Referenced by <a class="el" href="netcode_8c-source.html#l00301">replay()</a>, and <a class="el" href="tables_8c-source.html#l00934">setup_redirection()</a>.</p>

</div>
</div><p>
<a class="anchor" name="f6f22be6ccd514e154f5e811188d051b"></a><!-- doxytag: member="netcode.h::forward" ref="f6f22be6ccd514e154f5e811188d051b" args="(struct pkt_struct *pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int forward           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>pkt</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
forward the <a class="el" href="structpacket.html">packet</a> to the attacker or to the HIH according to its origin 
<p>
forward<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pkt,the</em>&nbsp;</td><td><a class="el" href="structpacket.html">packet</a> metadata structure to forward</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>OK if the <a class="el" href="structpacket.html">packet</a> has been succesfully sent </dd></dl>

<p>
If <a class="el" href="structpacket.html">packet</a> from HIH, we forward if to EXT with LIH source<p>
We set LIH source IP<p>
If TCP, we update the source port, the sequence number, and the checksum<p>
If UDP, we update the source port and the checksum<p>
If <a class="el" href="structpacket.html">packet</a> from EXT, we forward if to HIH<p>
If <a class="el" href="structpacket.html">packet</a> from HIH, we forward if to EXT with LIH source<p>
If TCP, we update the destination port, the acknowledgement number if any, and the checksum<p>
If UDP, we update the destination port and the checksum<p>
we update the IP checksum and send the packect 
<p>References <a class="el" href="types_8h-source.html#l00123">hih_struct::addr</a>, <a class="el" href="types_8h-source.html#l00212">pkt_struct::conn</a>, <a class="el" href="types_8h-source.html#l00126">hih_struct::delta</a>, <a class="el" href="tables_8h-source.html#l00120">EXT</a>, <a class="el" href="log_8h-source.html#l00100">H</a>, <a class="el" href="netcode_8c-source.html#l00361">hb_ip_checksum()</a>, <a class="el" href="types_8h-source.html#l00180">conn_struct::hih</a>, <a class="el" href="tables_8h-source.html#l00122">HIH</a>, <a class="el" href="types_8h-source.html#l00173">conn_struct::id</a>, <a class="el" href="types_8h-source.html#l00074">packet::ip</a>, <a class="el" href="types_8h-source.html#l00127">hih_struct::lih_addr</a>, <a class="el" href="tables_8h-source.html#l00147">NOK</a>, <a class="el" href="tables_8h-source.html#l00140">OK</a>, <a class="el" href="types_8h-source.html#l00208">pkt_struct::origin</a>, <a class="el" href="types_8h-source.html#l00207">pkt_struct::packet</a>, <a class="el" href="types_8h-source.html#l00124">hih_struct::port</a>, <a class="el" href="netcode_8c-source.html#l00087">send_raw()</a>, <a class="el" href="types_8h-source.html#l00094">tcp_packet::tcp</a>, <a class="el" href="types_8h-source.html#l00075">packet::tcp</a>, <a class="el" href="netcode_8c-source.html#l00475">tcp_checksum()</a>, and <a class="el" href="netcode_8c-source.html#l00374">udp_checksum()</a>.</p>

<p>Referenced by <a class="el" href="netcode_8c-source.html#l00301">replay()</a>, and <a class="el" href="tables_8c-source.html#l00934">setup_redirection()</a>.</p>

</div>
</div><p>
<a class="anchor" name="d578a8a62778555fafc3e1c85b67cc87"></a><!-- doxytag: member="netcode.h::hb_ip_checksum" ref="d578a8a62778555fafc3e1c85b67cc87" args="(struct iphdr *hdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int hb_ip_checksum           </td>
          <td>(</td>
          <td class="paramtype">struct iphdr *&nbsp;</td>
          <td class="paramname"> <em>hdr</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
update the checksum in the IP header 
<p>
hb_ip_checksum 
<p>References <a class="el" href="netcode_8c-source.html#l00050">in_cksum()</a>, and <a class="el" href="tables_8h-source.html#l00140">OK</a>.</p>

<p>Referenced by <a class="el" href="netcode_8c-source.html#l00149">forward()</a>, and <a class="el" href="netcode_8c-source.html#l00214">reply_reset()</a>.</p>

</div>
</div><p>
<a class="anchor" name="66fca3b08b64c478b6d91e83f2326628"></a><!-- doxytag: member="netcode.h::init_raw_sockets" ref="66fca3b08b64c478b6d91e83f2326628" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_raw_sockets           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
create the two raw sockets for UDP/IP and TCP/IP 
<p>
init_raw_sockets <dl class="return" compact><dt><b>Returns:</b></dt><dd>OK </dd></dl>

<p>
create the two raw sockets for UDP/IP and TCP/IP
<p>References <a class="el" href="tables_8h-source.html#l00140">OK</a>, <a class="el" href="netcode_8h-source.html#l00053">tcp_rsd</a>, and <a class="el" href="netcode_8h-source.html#l00053">udp_rsd</a>.</p>

<p>Referenced by <a class="el" href="honeybrid_8c-source.html#l01009">main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="8035030afa1e2ef8c04d0967d8a1ca51"></a><!-- doxytag: member="netcode.h::replay" ref="8035030afa1e2ef8c04d0967d8a1ca51" args="(struct conn_struct *connection_data, struct pkt_struct *pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int replay           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structconn__struct.html">conn_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>pkt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
reset the LIH when redirected to HIH 
<p>
replay<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>conn,:</em>&nbsp;</td><td>the connnection being replayed </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pkt,:</em>&nbsp;</td><td>the <a class="el" href="structpacket.html">packet</a> from HIH to test </td></tr>
  </table>
</dl>

<p>
If <a class="el" href="structpacket.html">packet</a> is from HIH and matches expected data then we replay the following packets from EXT to HIH until we find a <a class="el" href="structpacket.html">packet</a> from LIH<p>
Then we define expected data according to that <a class="el" href="structpacket.html">packet</a> 
<p>References <a class="el" href="types_8h-source.html#l00177">conn_struct::BUFFER</a>, <a class="el" href="types_8h-source.html#l00211">pkt_struct::DE</a>, <a class="el" href="netcode_8c-source.html#l00386">define_expected_data()</a>, <a class="el" href="tables_8h-source.html#l00120">EXT</a>, <a class="el" href="tables_8h-source.html#l00130">FORWARD</a>, <a class="el" href="netcode_8c-source.html#l00149">forward()</a>, <a class="el" href="tables_8c-source.html#l00339">free_pkt()</a>, <a class="el" href="log_8h-source.html#l00100">H</a>, <a class="el" href="tables_8h-source.html#l00122">HIH</a>, <a class="el" href="types_8h-source.html#l00173">conn_struct::id</a>, <a class="el" href="tables_8h-source.html#l00147">NOK</a>, <a class="el" href="tables_8h-source.html#l00140">OK</a>, <a class="el" href="types_8h-source.html#l00208">pkt_struct::origin</a>, <a class="el" href="types_8h-source.html#l00174">conn_struct::replay_id</a>, <a class="el" href="tables_8c-source.html#l00223">switch_state()</a>, and <a class="el" href="netcode_8c-source.html#l00405">test_expected()</a>.</p>

</div>
</div><p>
<a class="anchor" name="0a17e9db29ce866d9dbb3f8e000d4d88"></a><!-- doxytag: member="netcode.h::reply_reset" ref="0a17e9db29ce866d9dbb3f8e000d4d88" args="(struct packet p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int reply_reset           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpacket.html">packet</a>&nbsp;</td>
          <td class="paramname"> <em>p</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
creat a RST <a class="el" href="structpacket.html">packet</a> from a unexepcted <a class="el" href="structpacket.html">packet</a> and sends it with send_raw 
<p>
reply_reset<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>p,the</em>&nbsp;</td><td><a class="el" href="structpacket.html">packet</a> to which we reply the reset <a class="el" href="structpacket.html">packet</a> </td></tr>
  </table>
</dl>

<p>
reset only tcp connections<p>
fill up the IP header<p>
fill up the TCP header 
<p>References <a class="el" href="log_8h-source.html#l00100">H</a>, <a class="el" href="netcode_8c-source.html#l00361">hb_ip_checksum()</a>, <a class="el" href="types_8h-source.html#l00093">tcp_packet::ip</a>, <a class="el" href="types_8h-source.html#l00074">packet::ip</a>, <a class="el" href="tables_8h-source.html#l00147">NOK</a>, <a class="el" href="netcode_8c-source.html#l00087">send_raw()</a>, <a class="el" href="types_8h-source.html#l00075">packet::tcp</a>, and <a class="el" href="netcode_8c-source.html#l00475">tcp_checksum()</a>.</p>

</div>
</div><p>
<a class="anchor" name="f069fcb9bc933b9dab86937fe65ca0f5"></a><!-- doxytag: member="netcode.h::reset_lih" ref="f069fcb9bc933b9dab86937fe65ca0f5" args="(struct conn_struct *connection_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int reset_lih           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structconn__struct.html">conn_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>conn</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
reset the LIH when redirected to HIH 
<p>
reset_lih<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>conn,:</em>&nbsp;</td><td>the connnection that the LIH reset </td></tr>
  </table>
</dl>

<p>
find last <a class="el" href="structpacket.html">packet</a> from LIH<p>
call <a class="el" href="netcode_8c.html#0a17e9db29ce866d9dbb3f8e000d4d88" title="creat a RST packet from a unexepcted packet and sends it with send_raw">reply_reset()</a> with this <a class="el" href="structpacket.html">packet</a> 
<p>References <a class="el" href="types_8h-source.html#l00177">conn_struct::BUFFER</a>, <a class="el" href="log_8h-source.html#l00100">H</a>, <a class="el" href="types_8h-source.html#l00173">conn_struct::id</a>, <a class="el" href="types_8h-source.html#l00074">packet::ip</a>, <a class="el" href="tables_8h-source.html#l00121">LIH</a>, <a class="el" href="tables_8h-source.html#l00147">NOK</a>, <a class="el" href="types_8h-source.html#l00208">pkt_struct::origin</a>, and <a class="el" href="types_8h-source.html#l00207">pkt_struct::packet</a>.</p>

<p>Referenced by <a class="el" href="tables_8c-source.html#l00934">setup_redirection()</a>.</p>

</div>
</div><p>
<a class="anchor" name="5b7827c561225b58a81718e27501307f"></a><!-- doxytag: member="netcode.h::send_raw" ref="5b7827c561225b58a81718e27501307f" args="(struct iphdr *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_raw           </td>
          <td>(</td>
          <td class="paramtype">struct iphdr *&nbsp;</td>
          <td class="paramname"> <em>p</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
send a <a class="el" href="structpacket.html">packet</a> over a raw socket 
<p>
send_raw <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>p,the</em>&nbsp;</td><td><a class="el" href="structpacket.html">packet</a> structure that contains the <a class="el" href="structpacket.html">packet</a> to be sent </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>OK if the <a class="el" href="structpacket.html">packet</a> has been succesfully sent </dd></dl>

<p>
This line seg fault... sprintf(logbuf, "send_raw():\tSending raw packet from %s to %s\n", inet_ntoa(*(struct in_addr*)p-&gt;saddr), inet_ntoa(*(struct in_addr*)p-&gt;daddr));<p>
If TCP, use the TCP raw socket<p>
dst.sin_port = ((struct tcp_packet*)p)-&gt;tcp.dest;<p>
If UDP, use the UDP raw socket 
<p>References <a class="el" href="log_8h-source.html#l00100">H</a>, <a class="el" href="tables_8h-source.html#l00147">NOK</a>, <a class="el" href="tables_8h-source.html#l00140">OK</a>, <a class="el" href="netcode_8h-source.html#l00053">tcp_rsd</a>, and <a class="el" href="netcode_8h-source.html#l00053">udp_rsd</a>.</p>

<p>Referenced by <a class="el" href="netcode_8c-source.html#l00149">forward()</a>, and <a class="el" href="netcode_8c-source.html#l00214">reply_reset()</a>.</p>

</div>
</div><p>
<a class="anchor" name="76a1641651a94e4de2c397985c74ccd3"></a><!-- doxytag: member="netcode.h::tcp_checksum" ref="76a1641651a94e4de2c397985c74ccd3" args="(struct tcp_packet *pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tcp_checksum           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtcp__packet.html">tcp_packet</a> *&nbsp;</td>
          <td class="paramname"> <em>pkt</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
test for a new tcp checksum function <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pkt,:</em>&nbsp;</td><td><a class="el" href="structpacket.html">packet</a> to compute the checksum </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>OK </dd></dl>

<p>References <a class="el" href="netcode_8h-source.html#l00058">pseudotcphdr::daddr</a>, <a class="el" href="netcode_8c-source.html#l00050">in_cksum()</a>, <a class="el" href="types_8h-source.html#l00093">tcp_packet::ip</a>, <a class="el" href="tables_8h-source.html#l00140">OK</a>, <a class="el" href="types_8h-source.html#l00095">tcp_packet::payload</a>, <a class="el" href="netcode_8h-source.html#l00068">tcp_chk_packet::payload</a>, <a class="el" href="netcode_8h-source.html#l00060">pseudotcphdr::proto</a>, <a class="el" href="netcode_8h-source.html#l00066">tcp_chk_packet::pseudohdr</a>, <a class="el" href="netcode_8h-source.html#l00059">pseudotcphdr::res1</a>, <a class="el" href="netcode_8h-source.html#l00057">pseudotcphdr::saddr</a>, <a class="el" href="netcode_8h-source.html#l00067">tcp_chk_packet::tcp</a>, <a class="el" href="types_8h-source.html#l00094">tcp_packet::tcp</a>, and <a class="el" href="netcode_8h-source.html#l00061">pseudotcphdr::tcp_len</a>.</p>

<p>Referenced by <a class="el" href="netcode_8c-source.html#l00149">forward()</a>, and <a class="el" href="netcode_8c-source.html#l00214">reply_reset()</a>.</p>

</div>
</div><p>
<a class="anchor" name="51d4e253ea023290921f37ed78526d67"></a><!-- doxytag: member="netcode.h::test_expected" ref="51d4e253ea023290921f37ed78526d67" args="(struct conn_struct *connection_data, struct pkt_struct *pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int test_expected           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structconn__struct.html">conn_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>pkt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
get the <a class="el" href="structpacket.html">packet</a> from HIH, compare it to expected data, drop it and return the comparison result 
<p>
test_expected 
<p>
lock the structure g_static_rw_lock_writer_lock( &amp;conn-&gt;lock );<p>
free the lock g_static_rw_lock_writer_unlock( &amp;conn-&gt;lock );
<p>References <a class="el" href="types_8h-source.html#l00209">pkt_struct::data</a>, <a class="el" href="types_8h-source.html#l00178">conn_struct::expected_data</a>, <a class="el" href="log_8h-source.html#l00100">H</a>, <a class="el" href="types_8h-source.html#l00173">conn_struct::id</a>, <a class="el" href="types_8h-source.html#l00074">packet::ip</a>, <a class="el" href="types_8h-source.html#l00140">expected_data_struct::ip_proto</a>, <a class="el" href="tables_8h-source.html#l00147">NOK</a>, <a class="el" href="tables_8h-source.html#l00140">OK</a>, <a class="el" href="types_8h-source.html#l00207">pkt_struct::packet</a>, <a class="el" href="types_8h-source.html#l00143">expected_data_struct::payload</a>, <a class="el" href="types_8h-source.html#l00077">packet::payload</a>, <a class="el" href="types_8h-source.html#l00193">conn_struct::replay_problem</a>, <a class="el" href="types_8h-source.html#l00075">packet::tcp</a>, <a class="el" href="types_8h-source.html#l00142">expected_data_struct::tcp_ack_seq</a>, and <a class="el" href="types_8h-source.html#l00141">expected_data_struct::tcp_seq</a>.</p>

<p>Referenced by <a class="el" href="netcode_8c-source.html#l00301">replay()</a>.</p>

</div>
</div><p>
<a class="anchor" name="097d65899a9a179c22b9a47c188a6618"></a><!-- doxytag: member="netcode.h::udp_checksum" ref="097d65899a9a179c22b9a47c188a6618" args="(struct udp_packet *hdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int udp_checksum           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structudp__packet.html">udp_packet</a> *&nbsp;</td>
          <td class="paramname"> <em>hdr</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
update the checksum in the UDP header 
<p>
udp_checksum 
<p>References <a class="el" href="netcode_8c-source.html#l00050">in_cksum()</a>, <a class="el" href="tables_8h-source.html#l00140">OK</a>, and <a class="el" href="types_8h-source.html#l00111">udp_packet::udp</a>.</p>

<p>Referenced by <a class="el" href="netcode_8c-source.html#l00149">forward()</a>.</p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="cc494fc39cad003e3dab07fd09ffc2b2"></a><!-- doxytag: member="netcode.h::tcp_rsd" ref="cc494fc39cad003e3dab07fd09ffc2b2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="netcode_8h.html#cc494fc39cad003e3dab07fd09ffc2b2">tcp_rsd</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="netcode_8c-source.html#l00457">init_raw_sockets()</a>, <a class="el" href="honeybrid_8c-source.html#l01009">main()</a>, and <a class="el" href="netcode_8c-source.html#l00087">send_raw()</a>.</p>

</div>
</div><p>
<a class="anchor" name="a2f45e08bb2bae9d3c173db57d51de47"></a><!-- doxytag: member="netcode.h::udp_rsd" ref="a2f45e08bb2bae9d3c173db57d51de47" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="netcode_8h.html#a2f45e08bb2bae9d3c173db57d51de47">udp_rsd</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="netcode_8c-source.html#l00457">init_raw_sockets()</a>, <a class="el" href="honeybrid_8c-source.html#l01009">main()</a>, and <a class="el" href="netcode_8c-source.html#l00087">send_raw()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Feb 9 10:46:08 2010 for honeybrid by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
