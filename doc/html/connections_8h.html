<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>honeybrid: connections.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">honeybrid
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('connections_8h.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">connections.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="connections_8h__dep__incl.png" border="0" usemap="#connections_8hdep" alt=""/></div>
<map name="connections_8hdep" id="connections_8hdep">
</map>
</div>
</div>
<p><a href="connections_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a551b87d26d4ee19bf034b13fc8abc03b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connections_8h.html#a551b87d26d4ee19bf034b13fc8abc03b">switch_state</a> (struct <a class="el" href="structconn__struct.html">conn_struct</a> *<a class="el" href="types_8h.html#a9c44ceb0704b884503a6851f68cd7323">conn</a>, int new_state)</td></tr>
<tr class="memitem:a3b640e9f7fe3e3cd7c6baa6f359d24f1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connections_8h.html#a3b640e9f7fe3e3cd7c6baa6f359d24f1">init_pkt</a> (unsigned char *nf_packet, struct <a class="el" href="structpkt__struct.html">pkt_struct</a> **pk, u_int32_t <a class="el" href="types_8h.html#ac6bff33702f918bd1b6a9e8384f9176b">mark</a>)</td></tr>
<tr class="memdesc:a3b640e9f7fe3e3cd7c6baa6f359d24f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">init the current packet structure with meta-information such as the origin and the number of bytes of data  <a href="#a3b640e9f7fe3e3cd7c6baa6f359d24f1"></a><br/></td></tr>
<tr class="memitem:ad10aae951495042fa95be86fd1c97a88"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connections_8h.html#ad10aae951495042fa95be86fd1c97a88">free_pkt</a> (struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *pkt)</td></tr>
<tr class="memdesc:ad10aae951495042fa95be86fd1c97a88"><td class="mdescLeft">&#160;</td><td class="mdescRight">free the current packet structure  <a href="#ad10aae951495042fa95be86fd1c97a88"></a><br/></td></tr>
<tr class="memitem:a967a9efdead420227ffaf373072972f3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connections_8h.html#a967a9efdead420227ffaf373072972f3">store_pkt</a> (struct <a class="el" href="structconn__struct.html">conn_struct</a> *<a class="el" href="types_8h.html#a9c44ceb0704b884503a6851f68cd7323">conn</a>, struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *pkt)</td></tr>
<tr class="memdesc:a967a9efdead420227ffaf373072972f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store the current packet as part of the connection to replay it later.  <a href="#a967a9efdead420227ffaf373072972f3"></a><br/></td></tr>
<tr class="memitem:aabd0f3fb02edf8c02319fe86d0db5d9e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connections_8h.html#aabd0f3fb02edf8c02319fe86d0db5d9e">init_conn</a> (struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *pkt, struct <a class="el" href="structconn__struct.html">conn_struct</a> **<a class="el" href="types_8h.html#a9c44ceb0704b884503a6851f68cd7323">conn</a>)</td></tr>
<tr class="memdesc:aabd0f3fb02edf8c02319fe86d0db5d9e"><td class="mdescLeft">&#160;</td><td class="mdescRight">init the current context using the tuples  <a href="#aabd0f3fb02edf8c02319fe86d0db5d9e"></a><br/></td></tr>
<tr class="memitem:a06ca695d69aa0c4ce24c6986ac0b9685"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connections_8h.html#a06ca695d69aa0c4ce24c6986ac0b9685">expire_conn</a> (gpointer <a class="el" href="types_8h.html#a300a5cc1ad956ba66d9082e9e1945142">key</a>, struct <a class="el" href="structconn__struct.html">conn_struct</a> *cur_conn, gint *expiration_delay)</td></tr>
<tr class="memdesc:a06ca695d69aa0c4ce24c6986ac0b9685"><td class="mdescLeft">&#160;</td><td class="mdescRight">called for each entry in the B-Tree, if a time value is upper to "expiration_delay" (default is 120 sec) and the connection is not marked as redirected, entry is deleted  <a href="#a06ca695d69aa0c4ce24c6986ac0b9685"></a><br/></td></tr>
<tr class="memitem:a3b99286503ffeeb6930c555c55367455"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connections_8h.html#a3b99286503ffeeb6930c555c55367455">free_conn</a> (gpointer <a class="el" href="types_8h.html#a300a5cc1ad956ba66d9082e9e1945142">key</a>, gpointer trash)</td></tr>
<tr class="memdesc:a3b99286503ffeeb6930c555c55367455"><td class="mdescLeft">&#160;</td><td class="mdescRight">called for each entry in the pointer array, each entry is a key that is deleted from the B-Tree  <a href="#a3b99286503ffeeb6930c555c55367455"></a><br/></td></tr>
<tr class="memitem:a38133a66e9087c031a5e2b84c60432b2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connections_8h.html#a38133a66e9087c031a5e2b84c60432b2">init_mark</a> (struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *pkt, const struct <a class="el" href="structconn__struct.html">conn_struct</a> *<a class="el" href="types_8h.html#a9c44ceb0704b884503a6851f68cd7323">conn</a>)</td></tr>
<tr class="memitem:a2bbe646c052baf99f04a367ef6031d74"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connections_8h.html#a2bbe646c052baf99f04a367ef6031d74">clean</a> ()</td></tr>
<tr class="memdesc:a2bbe646c052baf99f04a367ef6031d74"><td class="mdescLeft">&#160;</td><td class="mdescRight">watchman for the b_tree, wake up every minute and check every entries  <a href="#a2bbe646c052baf99f04a367ef6031d74"></a><br/></td></tr>
<tr class="memitem:ab8a9c80a8bfe1235aaf70ddd7392641f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="connections_8h.html#ab8a9c80a8bfe1235aaf70ddd7392641f">setup_redirection</a> (struct <a class="el" href="structconn__struct.html">conn_struct</a> *<a class="el" href="types_8h.html#a9c44ceb0704b884503a6851f68cd7323">conn</a>, uint32_t hih_id)</td></tr>
<tr class="memdesc:ab8a9c80a8bfe1235aaf70ddd7392641f"><td class="mdescLeft">&#160;</td><td class="mdescRight">called for each connection being redirected to setup and start the redirection process  <a href="#ab8a9c80a8bfe1235aaf70ddd7392641f"></a><br/></td></tr>
</table>
<h2>Function Documentation</h2>
<a class="anchor" id="a2bbe646c052baf99f04a367ef6031d74"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clean </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>watchman for the b_tree, wake up every minute and check every entries </p>
<p>clean </p>
<p>init the table</p>
<p>call the clean function for each value</p>
<p>remove each key listed from the btree</p>
<p>free the array </p>

<p>References <a class="el" href="tables_8h.html#a36c5baef03ea7485da14b79b82f72015">conn_tree</a>, <a class="el" href="tables_8h.html#a5c043e2e87e17b78f397ff89d95f302d">conntreelock</a>, <a class="el" href="tables_8h.html#a57f24b1e8646b9629e88a1b6ac586173">entrytoclean</a>, <a class="el" href="connections_8c.html#a497e24fc80bc9dcfd7fe4b7ed768cdf7">expire_conn()</a>, <a class="el" href="connections_8c.html#a3b99286503ffeeb6930c555c55367455">free_conn()</a>, <a class="el" href="log_8h.html#aee722791bac86c287527610799a9d221">H</a>, <a class="el" href="tables_8h.html#aeb932625070a9b697fe9c90694f2f114">ICONFIG</a>, <a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586a2bc49ec37d6a5715dd23e85f1ff5bb59">OK</a>, <a class="el" href="tables_8h.html#ace6e63ff3d681fe97b74c2515ff1840a">threading</a>, <a class="el" href="tables_8h.html#acb03bc9a0ede7f2e555ca0f0048f1a3d">threading_cond</a>, and <a class="el" href="tables_8h.html#a42e98f163691ff576ed8caefec5df204">threading_cond_lock</a>.</p>

<p>Referenced by <a class="el" href="honeybrid_8c.html#a43e4391ca50d9d5fb13dcd6d375528f2">switch_clean()</a>.</p>

</div>
</div>
<a class="anchor" id="a06ca695d69aa0c4ce24c6986ac0b9685"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a> expire_conn </td>
          <td>(</td>
          <td class="paramtype">gpointer&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structconn__struct.html">conn_struct</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gint *&#160;</td>
          <td class="paramname"><em>expiration_delay</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>called for each entry in the B-Tree, if a time value is upper to "expiration_delay" (default is 120 sec) and the connection is not marked as redirected, entry is deleted </p>
<p>expire_conn </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">key,a</td><td>pointer to the current B-Tree key value </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">conn,a</td><td>pointer to the current B-Tree associated value </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">expiration_delay</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>FALSE, to continue to traverse the tree (if TRUE is returned, traversal is stopped) </dd></dl>
<p>output final statistics about the connection</p>
<p>lock the structure, this will never be unlocked</p>
<p>list the entry for later removal </p>

<p>References <a class="el" href="structconn__struct.html#afb8febabee6bbefb239f6357575841f1">conn_struct::access_time</a>, <a class="el" href="log_8c.html#a119d17dcedbaee5d6a932e7f0b08f3e9">connection_log()</a>, <a class="el" href="tables_8h.html#a57f24b1e8646b9629e88a1b6ac586173">entrytoclean</a>, <a class="el" href="log_8h.html#aee722791bac86c287527610799a9d221">H</a>, <a class="el" href="types_8h.html#ad743053347cb7262c2ae4d142760b9b4a0cb1b2c6a7db1f1084886c98909a3f36">INIT</a>, <a class="el" href="structconn__struct.html#ab3cc637c0e141dafce452feacbc7ca4f">conn_struct::lock</a>, and <a class="el" href="structconn__struct.html#a31586e2740a974795312dd85dbbf8216">conn_struct::state</a>.</p>

<p>Referenced by <a class="el" href="connections_8h.html#a2bbe646c052baf99f04a367ef6031d74">clean()</a>, and <a class="el" href="honeybrid_8c.html#a421d05d955ead3625ced86dccf934e3c">close_conn_tree()</a>.</p>

</div>
</div>
<a class="anchor" id="a3b99286503ffeeb6930c555c55367455"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_conn </td>
          <td>(</td>
          <td class="paramtype">gpointer&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gpointer&#160;</td>
          <td class="paramname"><em>trash</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>called for each entry in the pointer array, each entry is a key that is deleted from the B-Tree </p>
<p>free_conn </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">key,a</td><td>pointer to the current B-Tree key value stored in the pointer table </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">trash,user</td><td>data, unused </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="structconn__struct.html#aad2f9e86544f332f9f8e8ecf0f9c2b83">conn_struct::BUFFER</a>, <a class="el" href="types_8h.html#a9c44ceb0704b884503a6851f68cd7323">conn</a>, <a class="el" href="tables_8h.html#a36c5baef03ea7485da14b79b82f72015">conn_tree</a>, <a class="el" href="tables_8h.html#a5c043e2e87e17b78f397ff89d95f302d">conntreelock</a>, <a class="el" href="structconn__struct.html#ab5ec4d1b85e2d79cf88062777b744c39">conn_struct::decision_rule</a>, <a class="el" href="connections_8c.html#ad10aae951495042fa95be86fd1c97a88">free_pkt()</a>, <a class="el" href="log_8h.html#aee722791bac86c287527610799a9d221">H</a>, <a class="el" href="structconn__struct.html#a232cea36a68b07526039eb841bc0f8ba">conn_struct::hih</a>, <a class="el" href="structconn__struct.html#a834cfb13d41be0147b2b57b4a3902616">conn_struct::key</a>, <a class="el" href="structconn__struct.html#aacda4f72a8e63ec9185cb5187cfeb883">conn_struct::key_ext</a>, <a class="el" href="structconn__struct.html#a49070804763fa74efda9ec5d53124a00">conn_struct::key_lih</a>, <a class="el" href="structconn__struct.html#ab3cc637c0e141dafce452feacbc7ca4f">conn_struct::lock</a>, <a class="el" href="structhih__struct.html#aedf7e79356f2df99643e541fbf529c7d">hih_struct::redirect_key</a>, and <a class="el" href="structconn__struct.html#a8a561a6015fa4836591b12cdb2fb6a55">conn_struct::start_timestamp</a>.</p>

<p>Referenced by <a class="el" href="connections_8h.html#a2bbe646c052baf99f04a367ef6031d74">clean()</a>, and <a class="el" href="honeybrid_8c.html#a421d05d955ead3625ced86dccf934e3c">close_conn_tree()</a>.</p>

</div>
</div>
<a class="anchor" id="ad10aae951495042fa95be86fd1c97a88"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_pkt </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *&#160;</td>
          <td class="paramname"><em>pkt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>free the current packet structure </p>
<p>free_pkt </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pkt,:</td><td>struct <a class="el" href="structpkt__struct.html" title="The meta information of a packet stored in the conn_struct connection structure.">pkt_struct</a> to free </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="structpacket.html#af92293116debde497eb17ffe9c7c934a">packet::FRAME</a>, <a class="el" href="structpacket.html#adb0a78e8409806cae34e788c3d91bd7e">packet::ip</a>, <a class="el" href="structpkt__struct.html#aa54fb36f7fd1f9ebfb6f011d6c58cc88">pkt_struct::key</a>, <a class="el" href="structpkt__struct.html#a1fd1edcccc260e00329c0b2508c9cb8f">pkt_struct::key_dst</a>, <a class="el" href="structpkt__struct.html#a35e03e45c99b68ff970ecfb5ef3bcb48">pkt_struct::key_src</a>, and <a class="el" href="structpkt__struct.html#a7b19d8ade860794abfb9b5507a9c8800">pkt_struct::packet</a>.</p>

<p>Referenced by <a class="el" href="connections_8h.html#a3b99286503ffeeb6930c555c55367455">free_conn()</a>, and <a class="el" href="honeybrid_8c.html#a3e7cbe5088bfb1228e5ddc0b7039d74d">process_packet()</a>.</p>

</div>
</div>
<a class="anchor" id="aabd0f3fb02edf8c02319fe86d0db5d9e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a> init_conn </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *&#160;</td>
          <td class="paramname"><em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structconn__struct.html">conn_struct</a> **&#160;</td>
          <td class="paramname"><em>conn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>init the current context using the tuples </p>
<p>init_conn </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pkt,:</td><td>struct <a class="el" href="structpkt__struct.html" title="The meta information of a packet stored in the conn_struct connection structure.">pkt_struct</a> to work with </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">conn,:</td><td>struct <a class="el" href="structconn__struct.html" title="The meta informations of a connection stored in the main Binary Tree.">conn_struct</a> to work with </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if success, anything else otherwise </dd></dl>
<p>Get current time to update or create the structure </p>

<p>References <a class="el" href="connections_8c.html#a79ef6806da7a00754c7c023d5a8f86d6">conn_lookup()</a>, <a class="el" href="connections_8c.html#a3f164baaae9f6299757f775c94e55020">create_conn()</a>, <a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586ab057804c04435b55514a8babf5434ef6">NOK</a>, <a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586a2bc49ec37d6a5715dd23e85f1ff5bb59">OK</a>, and <a class="el" href="connections_8c.html#af9536dd396a0d0897eb9ac0b9e3b0068">update_conn()</a>.</p>

<p>Referenced by <a class="el" href="honeybrid_8c.html#a3e7cbe5088bfb1228e5ddc0b7039d74d">process_packet()</a>.</p>

</div>
</div>
<a class="anchor" id="a38133a66e9087c031a5e2b84c60432b2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a> init_mark </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *&#160;</td>
          <td class="paramname"><em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structconn__struct.html">conn_struct</a> *&#160;</td>
          <td class="paramname"><em>conn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="structconn__struct.html#a8d728a47b33c7a1c7c758a5f307ddd69">conn_struct::downlink_mark</a>, <a class="el" href="types_8h.html#abd865609267dfca1a4f5aeaa0de97d43a43943b97a80411494fa56399e53f17c2">EXT</a>, <a class="el" href="types_8h.html#abd865609267dfca1a4f5aeaa0de97d43a7257458731d0221b3896661d55b03e38">HIH</a>, <a class="el" href="types_8h.html#abd865609267dfca1a4f5aeaa0de97d43aefaa7221c4b44625d00738c2c78cacdf">LIH</a>, <a class="el" href="structpkt__struct.html#a9a2241dceb3a7f0810baeb47e030dfb6">pkt_struct::mark</a>, <a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586ab057804c04435b55514a8babf5434ef6">NOK</a>, <a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586a2bc49ec37d6a5715dd23e85f1ff5bb59">OK</a>, <a class="el" href="structpkt__struct.html#a05c3ad9f4f7c56cd975010b91f496f8c">pkt_struct::origin</a>, and <a class="el" href="structconn__struct.html#a8d2a57c5caa2ec998b25a7c14542a67e">conn_struct::uplink_mark</a>.</p>

<p>Referenced by <a class="el" href="honeybrid_8c.html#a3e7cbe5088bfb1228e5ddc0b7039d74d">process_packet()</a>.</p>

</div>
</div>
<a class="anchor" id="a3b640e9f7fe3e3cd7c6baa6f359d24f1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a> init_pkt </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>nf_packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpkt__struct.html">pkt_struct</a> **&#160;</td>
          <td class="paramname"><em>pkt_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u_int32_t&#160;</td>
          <td class="paramname"><em>mark</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>init the current packet structure with meta-information such as the origin and the number of bytes of data </p>
<p>init_pkt </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nf_packet,:</td><td>The raw packet from the queue </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pkt,:</td><td>The packet metadata structure for this packet </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mark,:</td><td>Netfilter mark of the packet </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the origin of the packet </dd></dl>
<p>Create fake ethernet header (used later by bpf_filter)</p>
<p>The most important part is to give to this ethernet header the type "IP protocol"</p>
<p>Add the packet IP header and payload to the packet structure</p>
<p>Process TCP packets</p>
<p>key_src is the tuple with the source information {Source IP}:{Source Port}</p>
<p>key_dst is the one with the destination information {Dest IP}:{Dest Port}</p>
<p>Process UDP packet</p>
<p>key_src</p>
<p>key_dst</p>
<p>Every other packets are ignored </p>

<p>References <a class="el" href="structpkt__struct.html#adb28f7f613f31edbe5941240eed9691d">pkt_struct::data</a>, <a class="el" href="structpkt__struct.html#af46efb0d380881fd318132ec291ea151">pkt_struct::DE</a>, <a class="el" href="types_8h.html#a4e7484afbe095e65767c43feb3a106cf">ETHER_HDR_LEN</a>, <a class="el" href="types_8h.html#abd865609267dfca1a4f5aeaa0de97d43a43943b97a80411494fa56399e53f17c2">EXT</a>, <a class="el" href="structpacket.html#af92293116debde497eb17ffe9c7c934a">packet::FRAME</a>, <a class="el" href="log_8h.html#aee722791bac86c287527610799a9d221">H</a>, <a class="el" href="structpacket.html#adb0a78e8409806cae34e788c3d91bd7e">packet::ip</a>, <a class="el" href="structpkt__struct.html#aa54fb36f7fd1f9ebfb6f011d6c58cc88">pkt_struct::key</a>, <a class="el" href="structpkt__struct.html#a1fd1edcccc260e00329c0b2508c9cb8f">pkt_struct::key_dst</a>, <a class="el" href="structpkt__struct.html#a35e03e45c99b68ff970ecfb5ef3bcb48">pkt_struct::key_src</a>, <a class="el" href="structpkt__struct.html#a9a2241dceb3a7f0810baeb47e030dfb6">pkt_struct::mark</a>, <a class="el" href="types_8h.html#ac6bff33702f918bd1b6a9e8384f9176b">mark</a>, <a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586ab057804c04435b55514a8babf5434ef6">NOK</a>, <a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586a2bc49ec37d6a5715dd23e85f1ff5bb59">OK</a>, <a class="el" href="structpkt__struct.html#a05c3ad9f4f7c56cd975010b91f496f8c">pkt_struct::origin</a>, <a class="el" href="structpkt__struct.html#a7b19d8ade860794abfb9b5507a9c8800">pkt_struct::packet</a>, <a class="el" href="structpacket.html#a12bbd46852da904df21c7985096cb2af">packet::payload</a>, <a class="el" href="structpkt__struct.html#a81a92b78a244c6bcb71643c64081a1c4">pkt_struct::position</a>, <a class="el" href="structpkt__struct.html#a87ff9f3cda91871890bfb42387525f09">pkt_struct::size</a>, <a class="el" href="types_8h.html#a91e19fa4fff461493e1a41f7c7aa4e5faa040cd7feeb588104634cdadf35abf1c">TCP</a>, <a class="el" href="structpacket.html#aaf31dd9e6a81f1835d146ecb9d220841">packet::tcp</a>, <a class="el" href="types_8h.html#a91e19fa4fff461493e1a41f7c7aa4e5fadb542475cf9d0636e4225e216cee9ae6">UDP</a>, and <a class="el" href="structpacket.html#af32a568eb0cb5d65a63f87f16343980e">packet::udp</a>.</p>

<p>Referenced by <a class="el" href="honeybrid_8c.html#a3e7cbe5088bfb1228e5ddc0b7039d74d">process_packet()</a>.</p>

</div>
</div>
<a class="anchor" id="ab8a9c80a8bfe1235aaf70ddd7392641f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a> setup_redirection </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structconn__struct.html">conn_struct</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>hih_use</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>called for each connection being redirected to setup and start the redirection process </p>
<p>setup_redirection </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conn,:</td><td>redirected connection metadata </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OK when done, NOK in case of failure </dd></dl>
<p>we check for concurrent connections using the same HIH_IP:PORT &lt;-&gt; EXT_IP</p>
<p>We then update the status of the connection structure</p>
<p>We reset the LIH</p>
<p>We replay the first packets </p>

<p>References <a class="el" href="structhih__struct.html#a205993a56804e307cd22223b9bbce2cb">hih_struct::addr</a>, <a class="el" href="netcode_8c.html#a48bca108e696141c6ff1b10898b20f0d">addr2int()</a>, <a class="el" href="structtarget.html#a74f5ffccc39a5e6dffeab17a399b26e3">target::back_handlers</a>, <a class="el" href="structconn__struct.html#aad2f9e86544f332f9f8e8ecf0f9c2b83">conn_struct::BUFFER</a>, <a class="el" href="types_8h.html#ad743053347cb7262c2ae4d142760b9b4a0d31cd90b1053f89cbae83cfc8b2ed4e">DECISION</a>, <a class="el" href="netcode_8c.html#a11677deb79aa67c898c08c67016b21cb">define_expected_data()</a>, <a class="el" href="types_8h.html#abd865609267dfca1a4f5aeaa0de97d43a43943b97a80411494fa56399e53f17c2">EXT</a>, <a class="el" href="types_8h.html#ad743053347cb7262c2ae4d142760b9b4aa26736999186daf8146f809e863712a1">FORWARD</a>, <a class="el" href="netcode_8c.html#aa1e9fee2dffebf3aa020dfc8a4e2f99c">forward()</a>, <a class="el" href="log_8h.html#aee722791bac86c287527610799a9d221">H</a>, <a class="el" href="tables_8h.html#ac78a111b39c6578a9368b4d9222debb2">high_redirection_table</a>, <a class="el" href="structconn__struct.html#a232cea36a68b07526039eb841bc0f8ba">conn_struct::hih</a>, <a class="el" href="structhih__struct.html#a8ad67174cfab3a04f3100987b3792033">hih_struct::hihID</a>, <a class="el" href="tables_8h.html#a24376f8f116dac1c43762f14f5cc70b3">hihredirlock</a>, <a class="el" href="structconn__struct.html#a0bc4aea24bdabb25c2a513b2c5eb8196">conn_struct::id</a>, <a class="el" href="structbackend.html#aa89ed67e233993e92b72f932940717b1">backend::iface</a>, <a class="el" href="structhih__struct.html#a3f82bffeac7d2c872fda57b85197f1a8">hih_struct::iface</a>, <a class="el" href="structinterface.html#a858fa47e46996b302851247f8d1adbc3">interface::ip</a>, <a class="el" href="structconn__struct.html#a834cfb13d41be0147b2b57b4a3902616">conn_struct::key</a>, <a class="el" href="structconn__struct.html#aacda4f72a8e63ec9185cb5187cfeb883">conn_struct::key_ext</a>, <a class="el" href="structconn__struct.html#a49070804763fa74efda9ec5d53124a00">conn_struct::key_lih</a>, <a class="el" href="structhih__struct.html#a327c7ce47ab8c0e09b8d571951001fe1">hih_struct::lih_addr</a>, <a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586ab057804c04435b55514a8babf5434ef6">NOK</a>, <a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586a2bc49ec37d6a5715dd23e85f1ff5bb59">OK</a>, <a class="el" href="structpkt__struct.html#a05c3ad9f4f7c56cd975010b91f496f8c">pkt_struct::origin</a>, <a class="el" href="structhih__struct.html#a74547f06e072047569a458cd4d51eb21">hih_struct::port</a>, <a class="el" href="structhih__struct.html#aedf7e79356f2df99643e541fbf529c7d">hih_struct::redirect_key</a>, <a class="el" href="types_8h.html#ad743053347cb7262c2ae4d142760b9b4ac8765fc3274cf354ca7df9eec128e2de">REPLAY</a>, <a class="el" href="structconn__struct.html#acf09130f5d972c57ab90ff1364902570">conn_struct::replay_id</a>, <a class="el" href="netcode_8c.html#ab247098954c17a597abbf2b4ca62689f">reset_lih()</a>, <a class="el" href="structconn__struct.html#ac23bd098074b63b21b59fd2a48e0070b">conn_struct::stat_time</a>, <a class="el" href="connections_8c.html#a551b87d26d4ee19bf034b13fc8abc03b">switch_state()</a>, <a class="el" href="structconn__struct.html#ace404d0f4aa1ec4437220f7f3bfaca19">conn_struct::target</a>, and <a class="el" href="structconn__struct.html#a8d2a57c5caa2ec998b25a7c14542a67e">conn_struct::uplink_mark</a>.</p>

<p>Referenced by <a class="el" href="decision__engine_8h.html#a5c13a1120e04937d7e462e468a1ef508">DE_process_packet()</a>.</p>

</div>
</div>
<a class="anchor" id="a967a9efdead420227ffaf373072972f3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a> store_pkt </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structconn__struct.html">conn_struct</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *&#160;</td>
          <td class="paramname"><em>pkt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Store the current packet as part of the connection to replay it later. </p>
<p>store_pkt function </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pkt,:</td><td>struct <a class="el" href="structpkt__struct.html" title="The meta information of a packet stored in the conn_struct connection structure.">pkt_struct</a> to work with </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">conn,:</td><td>struct <a class="el" href="structconn__struct.html" title="The meta informations of a connection stored in the main Binary Tree.">conn_struct</a> to work with</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the position of the packet in the list in case of success, a negative value if storage has failed </dd></dl>
<p>Lock the structure</p>
<p>Append pkt to the singly-linked list of conn</p>
<p>Get the packet position</p>
<p>Unlock the structure </p>

<p>References <a class="el" href="structconn__struct.html#aad2f9e86544f332f9f8e8ecf0f9c2b83">conn_struct::BUFFER</a>, <a class="el" href="log_8h.html#aee722791bac86c287527610799a9d221">H</a>, <a class="el" href="structconn__struct.html#a0bc4aea24bdabb25c2a513b2c5eb8196">conn_struct::id</a>, <a class="el" href="structconn__struct.html#a834cfb13d41be0147b2b57b4a3902616">conn_struct::key</a>, <a class="el" href="structconn__struct.html#ab3cc637c0e141dafce452feacbc7ca4f">conn_struct::lock</a>, <a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586ab057804c04435b55514a8babf5434ef6">NOK</a>, <a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586a2bc49ec37d6a5715dd23e85f1ff5bb59">OK</a>, and <a class="el" href="structpkt__struct.html#a81a92b78a244c6bcb71643c64081a1c4">pkt_struct::position</a>.</p>

<p>Referenced by <a class="el" href="honeybrid_8c.html#a3e7cbe5088bfb1228e5ddc0b7039d74d">process_packet()</a>.</p>

</div>
</div>
<a class="anchor" id="a551b87d26d4ee19bf034b13fc8abc03b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586">status_t</a> switch_state </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structconn__struct.html">conn_struct</a> *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>new_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="log_8h.html#aee722791bac86c287527610799a9d221">H</a>, <a class="el" href="structconn__struct.html#a0bc4aea24bdabb25c2a513b2c5eb8196">conn_struct::id</a>, <a class="el" href="constants_8c.html#a53ee833718a5f950bba7c471e1e1b2c9">lookup_state()</a>, <a class="el" href="types_8h.html#af9bff8ff1154a04a899276af806b8586a2bc49ec37d6a5715dd23e85f1ff5bb59">OK</a>, and <a class="el" href="structconn__struct.html#a31586e2740a974795312dd85dbbf8216">conn_struct::state</a>.</p>

<p>Referenced by <a class="el" href="decision__engine_8h.html#a5c13a1120e04937d7e462e468a1ef508">DE_process_packet()</a>, <a class="el" href="honeybrid_8c.html#a3e7cbe5088bfb1228e5ddc0b7039d74d">process_packet()</a>, <a class="el" href="netcode_8h.html#a65621b84aae6e90643655feb8fa950ad">replay()</a>, and <a class="el" href="connections_8h.html#ab8a9c80a8bfe1235aaf70ddd7392641f">setup_redirection()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="connections_8h.html">connections.h</a></li>
    <li class="footer">Generated on Thu May 16 2013 20:35:15 for honeybrid by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
