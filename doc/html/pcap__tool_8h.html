<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>honeybrid: pcap_tool.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>pcap_tool.h File Reference</h1><code>#include &lt;pcap.h&gt;</code><br>
<code>#include &lt;linux/netfilter.h&gt;</code><br>
<code>#include &lt;libnetfilter_queue/libnetfilter_queue.h&gt;</code><br>

<p>
<div class="dynheader">
Include dependency graph for pcap_tool.h:</div>
<div class="dynsection">
<p><center><img src="pcap__tool_8h__incl.png" border="0" usemap="#pcap_tool.h_map" alt=""></center>
</div>

<p>
<div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dynsection">
<p><center><img src="pcap__tool_8h__dep__incl.png" border="0" usemap="#pcap_tool.hdep_map" alt=""></center>
<map name="pcap_tool.hdep_map">
<area shape="rect" href="pcap__tool_8c.html" title="Pcap function to record communications." alt="" coords="7,84,100,111"></map>
</div>

<p>
<a href="pcap__tool_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcap__tool_8h.html#4e40701942ebfd0973e9d1e3295ea508">PCAPSIZE</a>&nbsp;&nbsp;&nbsp;2048</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcap__tool_8h.html#5d1b6b8c7266a5d1b7ac6e805fa977b8">record_pkt</a> (struct nfq_data *tb, char *p, int mode)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">record a <a class="el" href="structpacket.html">packet</a> in the current pcap file descriptor  <a href="#5d1b6b8c7266a5d1b7ac6e805fa977b8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcap__tool_8h.html#8809f8a26967cdc4c996d596fc2262b4">close_pcap_context</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcap__tool_8h.html#067b1a1ed99de594d97b4a09577174ac">pcap_record</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">pcap_t *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcap__tool_8h.html#a3e2854659adba6f0af5737f4c2274e3">pcap_main_desc</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">pcap_dumper_t *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcap__tool_8h.html#db4b98cd91e6c95dadb7a8e6a60ef668">pcap_output_current</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">pcap_dumper_t *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pcap__tool_8h.html#99273a6ff244861fe51b5caa528bceb9">pcap_output_redirected</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="4e40701942ebfd0973e9d1e3295ea508"></a><!-- doxytag: member="pcap_tool.h::PCAPSIZE" ref="4e40701942ebfd0973e9d1e3295ea508" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PCAPSIZE&nbsp;&nbsp;&nbsp;2048          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
max size of a <a class="el" href="structpacket.html">packet</a> in PCAP 
<p>Referenced by <a class="el" href="pcap__tool_8c-source.html#l00080">init_pcap_context()</a>.</p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="8809f8a26967cdc4c996d596fc2262b4"></a><!-- doxytag: member="pcap_tool.h::close_pcap_context" ref="8809f8a26967cdc4c996d596fc2262b4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int close_pcap_context           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
close_pcap_context, close the descriptors <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>\return</em>&nbsp;</td><td>0 on success, anything else otherwise </td></tr>
  </table>
</dl>

<p>References <a class="el" href="pcap__tool_8h-source.html#l00048">pcap_main_desc</a>, <a class="el" href="pcap__tool_8h-source.html#l00056">pcap_output_current</a>, and <a class="el" href="pcap__tool_8h-source.html#l00063">pcap_output_redirected</a>.</p>

</div>
</div><p>
<a class="anchor" name="5d1b6b8c7266a5d1b7ac6e805fa977b8"></a><!-- doxytag: member="pcap_tool.h::record_pkt" ref="5d1b6b8c7266a5d1b7ac6e805fa977b8" args="(struct nfq_data *tb, char *p, int mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int record_pkt           </td>
          <td>(</td>
          <td class="paramtype">struct nfq_data *&nbsp;</td>
          <td class="paramname"> <em>tb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
record a <a class="el" href="structpacket.html">packet</a> in the current pcap file descriptor 
<p>
record_pkt<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nfq_data</em>&nbsp;</td><td>*tb, raw <a class="el" href="structpacket.html">packet</a> ( used with nfqueue) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>*payload,<a class="el" href="structpacket.html">packet</a></em>&nbsp;</td><td>to record (used outside of nfqueue) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mode,0</em>&nbsp;</td><td>for non redirected connection, 1 for redirected connections, 2 for redirected outside nfqueue, 3 for non redirected outside nfqueue</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>0 on success, anything else otherwise </dd></dl>

<p>
if pcap desc doesn't exist, init pcap context<p>
switch the descriptor regarding to the mode (redirected or not)<p>
if the actual pcap output file is bigger than 10mo, create a new one<p>
close the current descriptor<p>
create output filename based on the conf and the time value<p>
open the new file descriptor<p>
L(33,"RECORD_PKT",file_name-&gt;str, 5);<p>
L(34,"RECORD_PKT",file_name-&gt;str,5);<p>
store new descriptor in global descriptor<p>
create pcap specific header<p>
mode 2 and 3 are used when we need to record a <a class="el" href="structpacket.html">packet</a> received outside of the netfilter queue<p>
+1 because the '' is not included<p>
pcap_dump, write pcap header and <a class="el" href="structpacket.html">packet</a> data to the output file <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pcap_output_current,descriptor</em>&nbsp;</td><td>to the current output file </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>&amp;phdr,pcap</em>&nbsp;</td><td>header </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>payload,<a class="el" href="structpacket.html">packet</a></em>&nbsp;</td><td>data</td></tr>
  </table>
</dl>
pcap_dump, write pcap header and <a class="el" href="structpacket.html">packet</a> data to the output file <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pcap_output_current,descriptor</em>&nbsp;</td><td>to the current output file </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>&amp;phdr,pcap</em>&nbsp;</td><td>header </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>(const</em>&nbsp;</td><td>u_char *)nf_packet, <a class="el" href="structpacket.html">packet</a> data from netfilter queue</td></tr>
  </table>
</dl>
L(36,"RECORD_PKT",NULL, 5); 
<p>References <a class="el" href="pcap__tool_8c-source.html#l00041">create_pcap_filename()</a>, <a class="el" href="pcap__tool_8c-source.html#l00080">init_pcap_context()</a>, <a class="el" href="pcap__tool_8h-source.html#l00048">pcap_main_desc</a>, <a class="el" href="pcap__tool_8h-source.html#l00056">pcap_output_current</a>, and <a class="el" href="pcap__tool_8h-source.html#l00063">pcap_output_redirected</a>.</p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a3e2854659adba6f0af5737f4c2274e3"></a><!-- doxytag: member="pcap_tool.h::pcap_main_desc" ref="a3e2854659adba6f0af5737f4c2274e3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcap_t* <a class="el" href="pcap__tool_8h.html#a3e2854659adba6f0af5737f4c2274e3">pcap_main_desc</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="pcap__tool_8c-source.html#l00243">close_pcap_context()</a>, <a class="el" href="pcap__tool_8c-source.html#l00080">init_pcap_context()</a>, and <a class="el" href="pcap__tool_8c-source.html#l00143">record_pkt()</a>.</p>

</div>
</div><p>
<a class="anchor" name="db4b98cd91e6c95dadb7a8e6a60ef668"></a><!-- doxytag: member="pcap_tool.h::pcap_output_current" ref="db4b98cd91e6c95dadb7a8e6a60ef668" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcap_dumper_t* <a class="el" href="pcap__tool_8h.html#db4b98cd91e6c95dadb7a8e6a60ef668">pcap_output_current</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="pcap__tool_8c-source.html#l00243">close_pcap_context()</a>, <a class="el" href="pcap__tool_8c-source.html#l00080">init_pcap_context()</a>, and <a class="el" href="pcap__tool_8c-source.html#l00143">record_pkt()</a>.</p>

</div>
</div><p>
<a class="anchor" name="99273a6ff244861fe51b5caa528bceb9"></a><!-- doxytag: member="pcap_tool.h::pcap_output_redirected" ref="99273a6ff244861fe51b5caa528bceb9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pcap_dumper_t* <a class="el" href="pcap__tool_8h.html#99273a6ff244861fe51b5caa528bceb9">pcap_output_redirected</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="pcap__tool_8c-source.html#l00243">close_pcap_context()</a>, <a class="el" href="pcap__tool_8c-source.html#l00080">init_pcap_context()</a>, and <a class="el" href="pcap__tool_8c-source.html#l00143">record_pkt()</a>.</p>

</div>
</div><p>
<a class="anchor" name="067b1a1ed99de594d97b4a09577174ac"></a><!-- doxytag: member="pcap_tool.h::pcap_record" ref="067b1a1ed99de594d97b4a09577174ac" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="pcap__tool_8h.html#067b1a1ed99de594d97b4a09577174ac">pcap_record</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Feb 9 10:46:08 2010 for honeybrid by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
