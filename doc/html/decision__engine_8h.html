<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>honeybrid: decision_engine.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>decision_engine.h File Reference</h1><code>#include &lt;glib.h&gt;</code><br>
<code>#include &quot;<a class="el" href="tables_8h-source.html">tables.h</a>&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for decision_engine.h:</div>
<div class="dynsection">
<p><center><img src="decision__engine_8h__incl.png" border="0" usemap="#decision_engine.h_map" alt=""></center>
<map name="decision_engine.h_map">
<area shape="rect" href="tables_8h.html" title="tables.h" alt="" coords="180,84,252,111"><area shape="rect" href="types_8h.html" title="types.h" alt="" coords="363,161,429,188"><area shape="rect" href="modules_8h.html" title="modules.h" alt="" coords="669,239,757,265"><area shape="rect" href="log_8h.html" title="log.h" alt="" coords="688,316,739,343"></map>
</div>

<p>
<div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dynsection">
<p><center><img src="decision__engine_8h__dep__incl.png" border="0" usemap="#decision_engine.hdep_map" alt=""></center>
<map name="decision_engine.hdep_map">
<area shape="rect" href="decision__engine_8c.html" title="Decision Engine for honeybrid." alt="" coords="5,84,139,111"><area shape="rect" href="honeybrid_8c.html" title="Main File." alt="" coords="163,84,259,111"><area shape="rect" href="rules_8c.html" title="rules.c" alt="" coords="283,84,347,111"></map>
</div>

<p>
<a href="decision__engine_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtree.html">tree</a></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="decision__engine_8h.html#8b4afd7bd94217a117105bfdafd1d3fe">DE_NO_RULE</a>&nbsp;&nbsp;&nbsp;-2</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="decision__engine_8h.html#470e142dabf88c6045d335a5ff86ae1f">DE_UNKNOWN</a>&nbsp;&nbsp;&nbsp;-1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="decision__engine_8h.html#7c87d5d06085dd3b20cde79b0d940e69">DE_REJECT</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="decision__engine_8h.html#38e2650908378822e9bf63b35b44e39e">DE_ACCEPT</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="decision__engine_8h.html#4235b084499261f6e0e6faf8bc529951">DE_create_tree</a> (const gchar *equation)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">build a boolean decision <a class="el" href="structtree.html">tree</a> for a given equation  <a href="#4235b084499261f6e0e6faf8bc529951"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="decision__engine_8h.html#ed34912c70e4db4b07f42ff72495c5df">DE_submit_packet</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">handle connections being decided and submits packets for decision  <a href="#ed34912c70e4db4b07f42ff72495c5df"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="decision__engine_8h.html#f8865693460ce6b4b4d8e9334597c266">DE_push_pkt</a> (struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *pkt)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">push <a class="el" href="structpacket.html">packet</a> to the DE_submit_pkt queue (equivalent of <a class="el" href="decision__engine_8c.html#ed34912c70e4db4b07f42ff72495c5df" title="handle connections being decided and submits packets for decision">DE_submit_packet()</a> but without using a thread)  <a href="#f8865693460ce6b4b4d8e9334597c266"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="decision__engine_8h.html#5c13a1120e04937d7e462e468a1ef508">DE_process_packet</a> (struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *pkt)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">submit packets for decision using decision rules and decision modules  <a href="#5c13a1120e04937d7e462e468a1ef508"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">GHashTable *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="decision__engine_8h.html#780ff23c64824364de64b04781c6bdf8">DE_rules</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct <a class="el" href="structtree.html">tree</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="decision__engine_8h.html#81fdbf3a1e37eaa4252eaadbaf1622f6">tree</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">GStaticRWLock&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="decision__engine_8h.html#40b8f08d811beeba2c61459b79080de5">DE_queue_lock</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">GSList *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="decision__engine_8h.html#03cdfd025c1a9358adae139d7f496c2e">DE_queue</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="38e2650908378822e9bf63b35b44e39e"></a><!-- doxytag: member="decision_engine.h::DE_ACCEPT" ref="38e2650908378822e9bf63b35b44e39e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DE_ACCEPT&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="decision__engine_8c-source.html#l00275">DE_process_packet()</a>.</p>

</div>
</div><p>
<a class="anchor" name="8b4afd7bd94217a117105bfdafd1d3fe"></a><!-- doxytag: member="decision_engine.h::DE_NO_RULE" ref="8b4afd7bd94217a117105bfdafd1d3fe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DE_NO_RULE&nbsp;&nbsp;&nbsp;-2          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="decision__engine_8c-source.html#l00275">DE_process_packet()</a>.</p>

</div>
</div><p>
<a class="anchor" name="7c87d5d06085dd3b20cde79b0d940e69"></a><!-- doxytag: member="decision_engine.h::DE_REJECT" ref="7c87d5d06085dd3b20cde79b0d940e69" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DE_REJECT&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="decision__engine_8c-source.html#l00275">DE_process_packet()</a>.</p>

</div>
</div><p>
<a class="anchor" name="470e142dabf88c6045d335a5ff86ae1f"></a><!-- doxytag: member="decision_engine.h::DE_UNKNOWN" ref="470e142dabf88c6045d335a5ff86ae1f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DE_UNKNOWN&nbsp;&nbsp;&nbsp;-1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="decision__engine_8c-source.html#l00275">DE_process_packet()</a>.</p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="4235b084499261f6e0e6faf8bc529951"></a><!-- doxytag: member="decision_engine.h::DE_create_tree" ref="4235b084499261f6e0e6faf8bc529951" args="(const gchar *equation)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* DE_create_tree           </td>
          <td>(</td>
          <td class="paramtype">const gchar *&nbsp;</td>
          <td class="paramname"> <em>equation</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
build a boolean decision <a class="el" href="structtree.html">tree</a> for a given equation 
<p>
DE_create_tree <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>equation</em>&nbsp;</td><td>a boolean equation</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>tree_root a pointer to the root of the boolean decision <a class="el" href="structtree.html">tree</a> </dd></dl>

<p>
create a glib table to store the equation<p>
first subgroup<p>
store address of the root<p>
for all the other subgroups<p>
get the pointer to the beginning of the new subtree<p>
connect new subtree to the previous one subtree (n) is a son of subtree(n-1)<p>
and go to the next one<p>
in subtree (n-1), each FALSE branch is connected to the head of subtree(n)<p>
this subtree is done, so n become n-1 
<p>References <a class="el" href="decision__engine_8c-source.html#l00047">DE_build_subtree()</a>, <a class="el" href="modules_8h-source.html#l00057">node::false</a>, and <a class="el" href="modules_8h-source.html#l00056">node::true</a>.</p>

<p>Referenced by <a class="el" href="rules_8c-source.html#l01176">yyparse()</a>.</p>

</div>
</div><p>
<a class="anchor" name="5c13a1120e04937d7e462e468a1ef508"></a><!-- doxytag: member="decision_engine.h::DE_process_packet" ref="5c13a1120e04937d7e462e468a1ef508" args="(struct pkt_struct *pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int DE_process_packet           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>pkt</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
submit packets for decision using decision rules and decision modules 
<p>
DE_process_packet 
<p>
default is to return "drop" to the QUEUE<p>
we update the state<p>
we release the <a class="el" href="structpacket.html">packet</a><p>
no backend defined, so we simply forward the packets to its destination<p>
backend defined, so we'll use the backend_rule for the next <a class="el" href="structpacket.html">packet</a><p>
we leave the state unmodified (the rule probably needs more material to decide), and we release the <a class="el" href="structpacket.html">packet</a> 
<p>References <a class="el" href="types_8h-source.html#l00045">target::back_rule</a>, <a class="el" href="types_8h-source.html#l00212">pkt_struct::conn</a>, <a class="el" href="tables_8h-source.html#l00133">CONTROL</a>, <a class="el" href="types_8h-source.html#l00046">target::control_rule</a>, <a class="el" href="decision__engine_8h-source.html#l00033">DE_ACCEPT</a>, <a class="el" href="decision__engine_8h-source.html#l00030">DE_NO_RULE</a>, <a class="el" href="decision__engine_8h-source.html#l00032">DE_REJECT</a>, <a class="el" href="decision__engine_8h-source.html#l00031">DE_UNKNOWN</a>, <a class="el" href="decision__engine_8c-source.html#l00196">decide()</a>, <a class="el" href="tables_8h-source.html#l00128">DECISION</a>, <a class="el" href="types_8h-source.html#l00190">conn_struct::decision_packet_id</a>, <a class="el" href="tables_8h-source.html#l00132">DROP</a>, <a class="el" href="types_8h-source.html#l00043">target::front_rule</a>, <a class="el" href="log_8h-source.html#l00100">H</a>, <a class="el" href="types_8h-source.html#l00173">conn_struct::id</a>, <a class="el" href="tables_8h-source.html#l00127">INIT</a>, <a class="el" href="types_8h-source.html#l00164">conn_struct::key</a>, <a class="el" href="tables_8h-source.html#l00140">OK</a>, <a class="el" href="tables_8h-source.html#l00131">PROXY</a>, <a class="el" href="tables_8c-source.html#l00934">setup_redirection()</a>, <a class="el" href="types_8h-source.html#l00172">conn_struct::state</a>, <a class="el" href="tables_8c-source.html#l00223">switch_state()</a>, <a class="el" href="types_8h-source.html#l00182">conn_struct::target</a>, and <a class="el" href="types_8h-source.html#l00188">conn_struct::total_packet</a>.</p>

<p>Referenced by <a class="el" href="decision__engine_8c-source.html#l00423">DE_submit_packet()</a>.</p>

</div>
</div><p>
<a class="anchor" name="f8865693460ce6b4b4d8e9334597c266"></a><!-- doxytag: member="decision_engine.h::DE_push_pkt" ref="f8865693460ce6b4b4d8e9334597c266" args="(struct pkt_struct *pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DE_push_pkt           </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpkt__struct.html">pkt_struct</a> *&nbsp;</td>
          <td class="paramname"> <em>pkt</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
push <a class="el" href="structpacket.html">packet</a> to the DE_submit_pkt queue (equivalent of <a class="el" href="decision__engine_8c.html#ed34912c70e4db4b07f42ff72495c5df" title="handle connections being decided and submits packets for decision">DE_submit_packet()</a> but without using a thread) 
<p>
DE_push_pkt DEPRECATED, <dl compact><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>to remove </dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pkt,:</em>&nbsp;</td><td><a class="el" href="structpacket.html">packet</a> to push </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>OK </dd></dl>

<p>References <a class="el" href="types_8h-source.html#l00212">pkt_struct::conn</a>, <a class="el" href="decision__engine_8h-source.html#l00061">DE_queue</a>, <a class="el" href="decision__engine_8h-source.html#l00059">DE_queue_lock</a>, <a class="el" href="log_8h-source.html#l00100">H</a>, and <a class="el" href="types_8h-source.html#l00173">conn_struct::id</a>.</p>

</div>
</div><p>
<a class="anchor" name="ed34912c70e4db4b07f42ff72495c5df"></a><!-- doxytag: member="decision_engine.h::DE_submit_packet" ref="ed34912c70e4db4b07f42ff72495c5df" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DE_submit_packet           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
handle connections being decided and submits packets for decision 
<p>
DE_submit_packet DEPRECATED, <dl compact><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>to remove </dd></dl>

<p>
Now that this entry was processed, we can remove it from the DE queue 
<p>References <a class="el" href="decision__engine_8c-source.html#l00275">DE_process_packet()</a>, <a class="el" href="decision__engine_8h-source.html#l00061">DE_queue</a>, <a class="el" href="decision__engine_8h-source.html#l00059">DE_queue_lock</a>, <a class="el" href="tables_8h-source.html#l00140">OK</a>, and <a class="el" href="tables_8h-source.html#l00039">threading</a>.</p>

<p>Referenced by <a class="el" href="honeybrid_8c-source.html#l01009">main()</a>.</p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="03cdfd025c1a9358adae139d7f496c2e"></a><!-- doxytag: member="decision_engine.h::DE_queue" ref="03cdfd025c1a9358adae139d7f496c2e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GSList* <a class="el" href="decision__engine_8h.html#03cdfd025c1a9358adae139d7f496c2e">DE_queue</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="decision__engine_8c-source.html#l00449">DE_push_pkt()</a>, <a class="el" href="decision__engine_8c-source.html#l00423">DE_submit_packet()</a>, and <a class="el" href="honeybrid_8c-source.html#l00449">init_variables()</a>.</p>

</div>
</div><p>
<a class="anchor" name="40b8f08d811beeba2c61459b79080de5"></a><!-- doxytag: member="decision_engine.h::DE_queue_lock" ref="40b8f08d811beeba2c61459b79080de5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GStaticRWLock <a class="el" href="decision__engine_8h.html#40b8f08d811beeba2c61459b79080de5">DE_queue_lock</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="decision__engine_8c-source.html#l00449">DE_push_pkt()</a>, <a class="el" href="decision__engine_8c-source.html#l00423">DE_submit_packet()</a>, and <a class="el" href="honeybrid_8c-source.html#l00449">init_variables()</a>.</p>

</div>
</div><p>
<a class="anchor" name="780ff23c64824364de64b04781c6bdf8"></a><!-- doxytag: member="decision_engine.h::DE_rules" ref="780ff23c64824364de64b04781c6bdf8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">GHashTable* <a class="el" href="decision__engine_8h.html#780ff23c64824364de64b04781c6bdf8">DE_rules</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="honeybrid_8c-source.html#l00206">close_hash()</a>, and <a class="el" href="honeybrid_8c-source.html#l00449">init_variables()</a>.</p>

</div>
</div><p>
<a class="anchor" name="81fdbf3a1e37eaa4252eaadbaf1622f6"></a><!-- doxytag: member="decision_engine.h::tree" ref="81fdbf3a1e37eaa4252eaadbaf1622f6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structtree.html">tree</a> <a class="el" href="structtree.html">tree</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Feb 9 10:46:07 2010 for honeybrid by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
